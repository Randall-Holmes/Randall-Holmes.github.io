\documentclass[12pt]{article}

\title{A self contained account of a class of models of tangled type theory}

\author{Randall Holmes}

\date{starting, 7/13/2023\\
typos and mental failures fixed, 7/18/2023\\
revised during 7/24/2023 Zoom meeting\\definition of substitutions and their action rewritten, 7/25/2023\\
freedom of action {\em is} needed for type counting}

\usepackage{amssymb}

\begin{document}

\maketitle

In this document, we give a self contained account of a structure which will turn out to be a model of tangled type theory, and therefore a witness to the consistency of Quine's New Foundations.
We will not discuss these theories until later in the narrative.  All of our business will be conducted in the usual set theory ZFC, and in fact in not very much of it, because New Foundations is not a very strong theory.

We are trying out the numbered paragraph format which Zermelo uses in his 1908 papers.

\begin{enumerate}

\item The construction has parameters which we introduce.

$\lambda$ is a limit ordinal.  Elements of $\lambda$ and a special object $-1$ will be our type indices (it simply doesn't matter what $-1$ is:  any set that isn't an ordinal will do).  The order on type indices is suggested by the choice of symbol for the additional type index:  $-1$ is the minimum in the order on type indices and the order on type indices extends the usual order on $\lambda$ (the natural order on ordinals $<\lambda$).

$\kappa$ is an uncountable regular cardinal greater than $\lambda$.  Sets of cardinality $<\kappa$ will be termed small and sets which are not small are called large.

$\mu$ is a strong limit cardinal $>\kappa$ of cofinality $\geq \kappa$.

These notations are fixed for the rest of the paper.

\item  Motivational notes:  we are letting parameters vary in size to support extensions of NF which are strong in various ways.  If one were aiming to put a cap on the consistency strength of NF (doing this precisely is not among the aims of this paper) note that $\lambda = \omega; \kappa = \omega_1; \mu = \beth_{\omega_1}$ works here.  We believe that NF is even weaker than these values of the parameters suggest, but we are not at pains here to show this.

\item We first build a system of {\em supertypes\/} indexed by the type indices, which will seen to be a model of nonextensional tangled type theory (we will explain what this means presently).

We write the supertype indexed by a type index $\iota$ as $\tau^*_\iota$.

Supertype $-1$ ($\tau^*_{-1}$) is unspecified at this point, except that it is a set of cardinality $\mu$.  We will describe it more precisely later, but its exact nature is unimportant at this stage.  Any choice of $\mu$ and a set of cardinality $\mu$ to serve as $\tau^*_{-1}$ can be taken to determine a system of supertypes at this point.

For $\alpha\in \lambda$ (a type index other than $-1$), we define $\tau^*_\alpha$ as $${\cal P} (\bigcup_{-1 \leq \iota<\alpha} \tau^*_\iota \cup \{\{\tau^*_\eta:-1\leq \eta <\alpha\}\}) \setminus {\cal P} (\bigcup_{-1 \leq \iota<\alpha}\tau^*_\iota):$$

an element of $\tau^*_\alpha$ is a union of subsets of the $\tau^*_\iota$'s for $-1\leq \iota <\alpha$ with the additional element $\{\tau_\eta:-1\leq \eta <\lambda\}$ added.

We denote $\{\tau^*_\eta:-1\leq \eta <\alpha\}$ by $\tau^+_{\alpha}$.

\item The axiom of foundation in the underlying set theory ZFC ensures that the supertypes are disjoint.  Notice that $\tau^+_{\alpha}$ has higher rank than any $\tau^*_\iota$ for
$-1\leq \iota <\alpha$ and so $\tau^+_{\alpha}$ cannot be an element of any element of $\tau^*_\iota$ for $-1\leq \iota<\alpha$, and so $\tau^*_\alpha$ (all of whose elements contain $\tau^+_{\alpha}$)  is disjoint from every
such $\tau^*_\iota$ (every type of smaller index).

None of the sets $\tau^+_{\alpha}$ are elements of any $\tau^*_\iota$:  no  $\tau^+_{\alpha}$ can be an element of $\tau^*_{-1}$ because $\tau^*_{-1} \in \tau^+_{\alpha}$ for every
$\alpha$.  For $\tau^+_{\alpha}$ to belong to $\tau_\beta$ ($\beta \neq -1)$ we would need $\tau^+_{\beta}$ to belong to each element of $\tau^+_\alpha$, including
$\tau^*_{-1}$, to which we have just seen that no $\tau^+_{\alpha}$ can belong.

\item For each $\alpha,\beta$ with $-1\leq\alpha<\beta<\lambda$, we define $x \in_{\alpha,\beta} y$ as holding iff $x \in \tau^*_\alpha \wedge y \in \tau^*_\beta \wedge x \in y$.  It is a nice feature of this scheme of representation that membership
between any two types is represented by a subset of the membership relation of the metatheory.

This structure is a model for nonextensional tangled type theory (TTT$^-$) which we now describe briefly for motivation.

TTT$^-$ is a theory with membership and equality as primitive relations and types indexed by the elements of $\lambda$ (type indices other than $-1$).

A formula $x^\alpha = y^\beta$ is meaningful iff $\alpha=\beta$.  A formula $x^\alpha \in y^\beta$ is meaningful iff $\alpha<\beta$.

The sole axiom scheme asserts that for any formula $\phi(x^\alpha)$ in the language and $\beta>\alpha$ there is $\{x^\alpha:\phi(x^\alpha)\}^\beta$ such that
$$(\forall z^\alpha:z^\alpha \in \{x^\alpha:\phi(x^\alpha)\}^\beta \leftrightarrow \phi(z^\alpha).$$

This theory is satisfied by the system of supertypes if we interpret $x^\alpha \in y^\beta$ as $x^\alpha \in_{\alpha,\beta} y^\beta$.

The theory is nonextensional:  there isn't a unique witness to serve as $\{x^\alpha:\phi(x^\alpha)\}^\beta$, though we can choose a canonical one, namely, the one whose intersection
with any $\tau_\iota$ with $\iota \neq \alpha$ is empty.

\item We further describe the theory TTT, in order to motivate the exertions we will go through in the rest of this paper.

TTT extends TTT$^-$ with the additional axiom scheme of extensionality, the collection of all well formed sentences of the form $$(\forall x^\beta y^\beta:(\forall z^\alpha:z^\alpha \in x^\beta \leftrightarrow z^\alpha \in y^\beta)\rightarrow x^\beta=y^\beta).$$

It is known that the consistency of TTT implies (in fact is equivalent to) the consistency of New Foundations.  We will discuss this later.

\item In the system of supertypes, each element of type positive $\alpha$ has an extension over each type $\beta\in \alpha$, namely, its intersection with type $\beta$.  These extensions can be mixed and matched freely:  there are many type $\alpha$ objects with any given extension over type $\beta$ (even in the case $\beta=0, \alpha=1$, as we can vary the intersection of
the type $\alpha$ object with type $-1$).

 In a model of TTT, each object of positive type is uniquely determined by each of its extensions individually.  This means that one extension of any particular object determines the others.
Our construction continues by exhibiting how this is done in our construction, starting with a presentation of more detail about type $-1$.

\item We will refer to the elements of type $-1$ as {\em atoms\/}.  They are not atoms in the sense of the metatheory (in fact, we will say something about their extensions as sets in a moment) but it is convenient to have a generic term for them (and in earlier constructions carried out in ZFA, analogous objects were atoms).

\item We now specify exactly what $\tau^*_{-1}$ is (in terms of the parameters $\kappa$ and $\mu$).

$\tau^*_{-1}= \{(\nu,\beta,\gamma,\alpha):\nu<\mu \wedge  \beta \in \lambda\cup \{-1\} \wedge \gamma \in \lambda \setminus \{\beta\}\wedge \alpha<\kappa\}$

\item For any suitable $\nu, \beta, \gamma$ we define $\Lambda_{\nu,\beta,\gamma}$ as $\{(\nu,\beta,\gamma,\alpha)\in \tau^*_{-1}:\alpha<\kappa\}$.  We regard this notation as defined
only if the resulting set is nonempty.  Such sets are called {\em litters} and the set of litters is a partition of $\tau^*_{-1}$ into sets of cardinality $\kappa$.

We define $X_{\beta,\gamma}$ as \{$\Lambda_{\nu,\beta,\gamma}:\nu<\mu\}$.  The use of this partition of the litters will be seen below.

\item A subset of $\tau^*_{-1}$ with small symmetric difference from a litter we call a {\em near-litter\/}.  For any near-litter $N$ we define $N^\circ$ as the uniquely determined litter $L$
such that $|N \Delta L|<\kappa$.  If $M$ and $N$ are litters, we write $M \sim N$ [read ``$M$ is near $N$"] for $|M \Delta N| < \kappa$.  This is an equivalence relation on near-litters.

\item Our intention is to construct $\tau_\iota$ for each type index $\iota$ in such a way that $\tau_{-1} = \tau^*_{-1}$ (and we will henceforth abandon the latter notation, always writing $\tau_{-1}$)
and for each $\alpha \in \lambda$, $\tau_\alpha \subseteq \tau^*_\alpha$ and $|\tau_\alpha| = \mu$, and for each $-1 \leq \alpha < \beta <\lambda$ and $x \in \tau_\beta$,
$x \cap \tau^*_\alpha\subseteq \tau_\alpha$.   Further, for each $-1<\gamma<\beta<\lambda$ we
have for $x,y \in \tau_\beta$ that $x \cap \tau_\gamma = y \cap \tau_\gamma \rightarrow x=y$:  we have extensionality (in the strong form required to interpret TTT)  for the types indexed by ordinals.  There are of course further conditions to be unfolded as we proceed.

The intention is that for each $\beta \in \lambda$, $\tau_\beta$ will interpret type $\beta$ of TTT and that the intersection of the membership relation of the metatheory with $\tau_\gamma \times \tau_\beta$ will interpret the membership of type $\gamma$ objects in type $\beta$ objects when $\gamma<\beta$.

\item Our strategy will be to fix an $\alpha\in \lambda$ and hypothesize that the sets $\tau_\beta$ have already been constructed for each $\beta<\alpha$ (satisfying these conditions [and others yet to be stated]), and then describe how $\tau_\alpha$ is to be constructed [supposing at all points that earlier $\tau_\beta$'s were constructed in the same way].   We suppose that we have already specified
a well-ordering $\leq_\beta$ with order type $\mu$ of each type $\tau_\beta$ with $-1\leq \beta <\alpha$ (special conditions on the choice of these well-orderings will be given later).   

\item For any near-litter $N$ and $\gamma\neq -1$, we define $N_\gamma$ as the unique element $x$  of $\tau_\gamma$ with $x \cap \tau_{-1} = N$.  We stipulate that there is one (for any $N$ and for $\gamma<\alpha$).  More generally, if
$X \subseteq \tau_{-1}$, $X_\gamma$ is the unique element $x$ of $\tau_\gamma$ with $x \cap \tau_{-1} = X$, if there is one.  We do provide that $\emptyset_\gamma$ and $\{x\}_\gamma$ will exist
for $x \in \tau_{-1}$, $\gamma<\alpha$.

\item We define for each element $x$ of any $\tau_\beta$ the index $\iota_*(x)$
as the order type of the restriction of $\leq_\beta$ to $\{y \in \tau_\beta:y <_\beta x\}$.  Note that the domain of $\iota_*$ is the union of all the types!

\item We first indicate how extensionality is to be enforced.  

\item We construct, for each pair of ordinals $\beta,\gamma<\alpha$ with $\beta \neq \gamma\neq -1$ (note that $\beta$ can be $-1$),  an injection $f_{\beta,\gamma}$ from $\tau_\beta$ into $X_{\beta,\gamma} = \{\Lambda_{\nu,\beta,\gamma}:\nu<\mu\}$  (whose definition does not actually depend on $\alpha$:  it will be the same at every stage).

 $f_{\beta,\gamma}$ is an injection from $\tau_\beta$ into $X_{\beta,\gamma}$:  note that the ranges of distinct $f_{\beta,\gamma}$'s are disjoint.
When we define $f_{\beta,\gamma}(x)$, we presume that we have already defined it for $y <_\beta x$.
We define $f_{\beta,\gamma}(x)$ as $L\cap \tau_{-1}$, where $L$ is $<_\gamma$-first such that $L\cap \tau_{-1} \in X_{\beta,\gamma}$ and for every $N \sim L \cap \tau_{-1}$, $\iota_*(N_\gamma)>\iota_*(x)$ [and if $\beta=-1$, $\iota_*(N_\gamma)>\iota_*(\{x\}_0)$ (NOTE:  do I need this here?)], and for any $y<_\beta x$, $f_{\beta,\gamma}(y) \neq L\cap \tau_{-1}$.  That this can be done relies on the fact that the order type of each $\leq_\beta$ is $\mu$.

\item Let $-1<\beta\leq \alpha$.


Let $\tau_\beta^1$ be the set of elements of $\tau_\beta^*$ satisfying $x \cap \tau^*_\gamma \subseteq \tau_\gamma$ for each $\gamma<\beta$.

Let $\tau_\beta^2$ be the set of elements of $\tau_\beta^1$ which are ``weakly extensional" in a sense we now define.

 An extension of an element $x$ of $\tau_\beta^1$ is a set $x \cap \tau_\gamma$ for $-1 \leq \gamma <\beta$ [we call this extension for a particular value of $\gamma$ the $\gamma$-extension].  We say that an element $x$ of  $\tau_\beta^1$ is {\em weakly extensional\/}
iff it has an extension $x \cap \tau_\gamma$, called a distinguished extension, which has the property that if any extension of $x$ is empty or if $x \cap \tau_{-1}$ is nonempty, $\gamma = -1$, and that for any $\delta \in \beta \setminus \{-1,\gamma\}$ we have $$x \cap \tau_\delta = \{N_\delta:N^\circ \in f_{\gamma,\delta}``(x \cap \tau_\gamma)\}.$$

We pause to define a function implementing this.  For any nonempty subset $X$ of $\tau_\gamma$, we define $$A_\delta(X) =  \{N_\delta:N^\circ \in f_{\gamma,\delta}``(X)\}.$$

Note that this function $A_\delta$ can be taken to have the quite large domain $$\bigcup_{\gamma \in \beta \setminus \{\delta,-1\}} {\cal P}(\tau_\gamma) \setminus \{\emptyset\},$$ since we can determine given a set in the domain what the appropriate value of $\gamma$ is.
Strictly speaking, this should be written $A^{\beta}_{\delta}$.

We can then state that a distinguished extension $x \cap \tau_\gamma$ of $x$ is characterized by the condition that for each $\delta$ not equal to $\gamma$ or $-1$,
$x \cap \tau_\delta = A_\delta(x \cap \tau_\gamma)$, and if $\gamma \neq -1$, $x \cap \tau_{-1}$ is empty.

Note that this allows us immediately to determine all extensions of objects $N_\gamma$ for $N$ a near-litter or $\{x\}_\gamma$ for $x$ an atom, because their nonempty $-1$-extension is seen to be their distinguished extension.

It is part of the hypotheses of the construction that $\tau_\beta \subseteq \tau^2_\beta$ for each ordinal $\beta$ less than $\alpha$:  elements of types already constructed are weakly extensional.

\item We show that no $x$ has more than one distinguished extension.  If the distinguished extension of $x$ is empty, all extensions of $x$ are empty, and we note further that 
the $-1$-extension is designated as the distinguished extension (of course all the extensions are the same set).  Note further that if the distinguished extension of $x$ is nonempty,
and $c$ is the element of this extension with minimal image under $\iota_*$, then every element of every other extension will have image under $\iota_*$ exceeding $\iota_*(c)$, because of the way the $f$ maps are constructed,  establishing that there is only one distinguished extension.

\item  That every element of a type in our system of types is weakly extensional will not enforce the extensionality condition we want.  Let $-1 \leq \gamma < \beta \leq \alpha$, and let
$x,y \in \tau^2_\beta$ with $x \cap \tau_\gamma = y \cap \tau_\gamma$.   

If $x \cap \tau_\gamma = y \cap \tau_\gamma$ is the empty set, then $x=y$ is immediate, because all the extensions of both sets are empty.  Note that if any extension
of $x$ or $y$ is empty, all are, so we can suppose hereinafter that all extensions of $x$ and $y$ are nonempty.

If the distinguished extensions of $x$ and $y$ are both the $\delta$-extension for some $\delta$ (which might or might not be $\gamma$), then again $x=y$ because we have a method of computation of all other extensions of $x$ and $y$ which will give $x \cap \tau_\epsilon = y \cap \tau_\epsilon$ for each appropriate $\epsilon$. 

If the distinguished extensions of $x$ and $y$ (supposed nonempty) are the $\delta$-extension of $x$ and the $\epsilon$-extension of $y$, with $\delta \neq \epsilon$, then any $z$ in the $\gamma$-extension of $x$ must be of the form $N_\gamma$ where $N^\circ$ is in the range of $f_{\delta,\gamma}$ and in the range of $f_{\epsilon,\gamma}$, and this is impossible, as the ranges of these maps are disjoint.

The possibility which cannot be excluded is that $x \cap \tau_\gamma = y \cap \tau_\gamma$ is the distinguished extension of one of $x,y$ and not of the other.

\item  Let $-1 < \beta \leq \alpha$.  We are working on defining the collection $\tau_\beta^3$ of {\em extensional\/} elements of $\tau^2_\beta$ (so to begin with,
an extensional element of $\tau^1_\beta$ is weakly extensional).

The maps $A_\delta$ defined above are injective.  The ranges of distinct maps $A_\delta$ are disjoint.  

Thus, we can define $A^{-1}(x)$ for $x \in \bigcup_{\gamma \in \beta\setminus \{-1\}} {\cal P} (\tau_\gamma) \setminus \{\emptyset\}$ as the unique $y$ such that $A_{\delta}(y)=x$ for some $\delta$ ($\delta$ of course being determined by $x$), if such a $y$ exists.  The map $A^{-1}$ is of course partial:  but for any $x$, if there is any such $y$ there is only one.

Strictly, we should define $A_{[\beta]}^{-1}(x)$ for $x \in \bigcup_{\gamma \in \beta\setminus \{-1\}} {\cal P} (\tau_\gamma) \setminus \{\emptyset\}$ as the unique $y$ such that $A^\beta_{\delta}(y)=x$ for some $\delta$ ($\delta$ of course being determined by $x$), if such a $y$ exists:  the explicit dependence on $\beta$ is not needed for the discussion here but might be relevant elsewhere.   The brackets are to avoid parsing it as $(A_\beta)^{-1}$.

If $c$ is the element of $x$ with minimal image under $\iota_*$, the element $d$ with minimal image under $\iota_*$ in any $A_\delta(x)$ will have $\iota_*(d) > \iota_*(c)$ because
of the way the $f$ maps are defined.  This implies that for any $x$, if $c$ is the element of $x$ with minimal image under $\iota_*$, and $A^{-1}(x)$ exists, then if
$d$ is the element of $A^{-1}(x)$ with minimal image under $\iota_*$, we have $\iota_*(d) < \iota_*(c)$.  This in turn implies that no set has infinitely many iterated images
under $A^{-1}$.

We then define $\tau^3_\beta$ as the collection of all elements $x$ of $\tau^2_\beta$ with the property that either the distinguished extension of $x$ is empty or the collection of iterated images of the distinguished extension of
$x$ under $A^{-1}$ (not including $x$) is of even cardinality.  Note that since every other extension of $x$ is an image of the distinguished extension under an $A_\delta$, they all have odd numbers of iterated images under $A^{-1}$.  

Now observe that in the case where two distinct elements $x,y$ of $\tau^2_\beta$ have the same $\gamma$-extension for a suitable $\gamma$, described above,
the common extension of $x$ and $y$ is the distinguished extension of one of them (wlog $x$) and not the distinguished extension of the other, and so the image under $A_\gamma$ of the distinguished extension of $y$.  This means that one of $x$ and $y$ is extensional, and the other is not, by considering the parities of the cardinalities of the sets of iterated images of the respective distinguished extensions under $A^{-1}$.  Thus,if  two distinct elements $x,y$ of $\tau^3_\beta$ have the same $\gamma$-extension for a suitable $\gamma$, it follows that $x=y$.

We further state that $\tau_\beta \subseteq \tau^3_\beta$ for $-1 < \beta < \alpha$ as a hypothesis of the construction:  all sets in types already constructed are extensional.

\item  We are going to attempt a different approach here.  Rather than defining the extensions we will include in our model as those symmetric under a class of permutations, we will
attempt to directly describe codes for the construction of these extensions (clearly a closely related approach, but we think it may have formal advantages).  A symmetry requirement will appear!

\item  A typed near-litter is an element $N_\gamma$ of $\tau_\gamma$ where $N$ is a near-litter.  A typed atom is an element $\{x\}_\gamma$ of $\tau_\gamma$ where
$x \in \tau_{-1}$.

A {\em support element\/} is a pair $(x,A)$ where $A$ is a finite subset of type indices with $x$ either an atom (type $-1$) [in which case we call it an atomic support element and ${\tt min}(A) =-1$] or a typed near-litter (of some type $>-1$ and $x \in \tau_{{\tt min}(A)}$ [in which case we call it a near-litter support element].

A {\em $\beta$-support\/} is a small set of support elements $(x,A)$ each of which has ${\tt max}(A)=\beta$, with the technical property that if it contains distinct $(x,A)$ and $(y,A)$ [with the same second component;  not all elements of a support need have the same second component], and $x$ and $y$ are both typed near-litters, they have disjoint $-1$-extensions.

For any $\beta$-support $S$ and $\gamma<\beta$, we define $S_\gamma$ as $$\{(x,A):{\tt max}(A)=\gamma \wedge (x,A\cup \{\beta\}) \in S\}.$$

\item  We now set out to define the symmetry condition which allows us to determine which elements of $\tau^3_\alpha$ belong to $\tau_\alpha$.

\item We define a $-1$-substitution as a permutation $\sigma$ of $\tau_{-1}$ such that for any near-litter $N$, $\sigma``N$ is a near-litter.

We define a $\beta$-presubstitution ($\beta\in \lambda$) as a permutation $\sigma$ of the atomic support elements $(x,A)$ with ${\tt max}(A)=\beta$, with the following properties:

\begin {enumerate}

\item $\pi_1(\sigma((x,A))) = A$ for all $(x,A)$ in the domain of $\sigma$.  This shows that $\sigma$ independently permutes, for each $A$ with minimum $-1$, the set $\{(x,A):x \in \tau_{-1}\}$.

\item For each $A$, the permutation $\sigma_A$ defined by $\sigma((x,A)) = (\sigma_A(x),A)$ is a $-1$-substitution.

\end{enumerate}

For each $\beta$-presubstitution $\sigma$ and ordinal $\gamma<\beta$ we define $\sigma_\gamma$ as the $\gamma$-presubstitution such that $\sigma_\gamma((x,A)) = (y,A)$ (for $(x,A)$ in the known domain of a $\gamma$-presubstitution) iff $\sigma((x,A \cup \{\beta\})) = (y,A \cup \{\beta\})$.
We define $\sigma_{-1}(x) = \pi_1(\sigma((x,\{\beta,-1\}))$.

\item  We define the action of a presubstitution on elements of our structure and on supports.  For any $x$ in $\tau_\beta$ and $\beta$-presubstitution $\sigma$ ($\beta>-1$), $\sigma[x]$ is the element of $\tau^*_\beta$ whose $\gamma$-extension is $\{\sigma_\gamma[y]:y \in x \cap \tau_\gamma\}$ for each type index $\gamma<\beta$.  In
the case $\gamma=-1$, $\sigma_{-1}[y] = \sigma_{-1}(y)$.

We define the action of a $\beta$-presubstitution $\sigma$ on support elements.  If $(x,A)$ is a $\beta$-atomic support element, $\sigma[(x,A)] = \sigma((x,A))$.  If $(N,A)$ is a $\beta$-near-litter support element, $\sigma[(N,A)] = ((\sigma_{A \cup \{-1\}}``N)_{{\tt min}(A)},A)$.

We define $\sigma(S)$, where $\sigma$ is a $\beta$-presubstitution and $S$ is a $\beta$-support, as $\{\sigma[s]:s \in S\}$.

\item  We now motivate and define the notion of $\beta$-substitution.

We would like to restrict to $\beta$-presubstitutions under which $\tau_\beta$ is closed.  Consider the action of a $\beta$-presubstitution on an element $X$ of $\tau_\beta$ whose $\gamma$-extension ($\gamma \neq -1$) is a singleton $\{x\}$.  We certainly want there to be such an element of $\tau_\beta$
for each $x \in \tau_\gamma$, since this would be true if our structure satisfied TTT, though we have not assumed this to be true [and we are not formally assuming this here, merely discussing this case for motivation].  The $\delta$-extension of $X$ for $\delta \in \beta \setminus \{\gamma,-1\}$ would be $\{N_\delta:N^\circ = f_{\gamma,\delta}(x)\}$.
The $\gamma$-extension of $\sigma[X]$ is $\{\sigma_\gamma[x]\}$ and the $\delta$-extension of $\sigma[X]$ is $\{\sigma_\delta[N_\delta]:N^\circ = f_{\gamma,\delta}(x)\}$.  

For $\sigma[X]$ to be extensional, we need the $\delta$-extension of $\sigma[X]$ to be $\{N_\delta:N^\circ = f_{\gamma,\delta}(\sigma_\gamma[x])\}$.

This motivates our definition of a $\beta$-substitution $(\beta>-1)$ as a $\beta$-presubstitution such that $$\{\sigma_\delta[N_\delta]:N^\circ = f_{\gamma,\delta}(x)\} = \{N_\delta:N^\circ = f_{\gamma,\delta}(\sigma_\gamma[x])\},$$ for each appropriate $\gamma$, which can readily be seen to be equivalent to the assertion that
$\sigma_\delta[f_{\gamma,\delta}(x)_\delta] \cap \tau_{-1} \sim  f_{\gamma,\delta}[\sigma_\gamma[x]]$.

We provide as a hypothesis of the construction that $\tau_\beta$ is closed under $\beta$-substitutions for each $\beta<\alpha$:  we claim that the additional condition which we have shown to be necessary for our purposes will also turn out to be sufficient when all details of the construction are seen.

\item We define the notion of a code for an element of our structure.  We use the notation $\chi$ for the function sending a code to what it codes.

A $-1$-code is simply an atom, and an atom is a code for itself and only for itself:  for $x \in \tau_{-1}$, $\chi(x)=x$.

A  $\beta$-code for $\beta$ an ordinal is a pair $(S,\Sigma)$ where $S$ is a $\beta$-support and, for some $\gamma<\sigma$, $\Sigma$ is a set of $\gamma$-codes such that $\chi``\Sigma$ has an even number of iterated images (other than itself) under $A_{[\beta]}^{-1}$, and any $\beta$-substitution $\sigma$ such that $(\forall s \in S:\pi[s]=s)$ also
satisfies $\{\sigma_\gamma[y]:y \in \chi``\Sigma\} = \chi``\Sigma$, and for each code $c$ in $\Sigma$, $\pi_1(c)$ is a superset of $S_\gamma$.  In this case $\chi((S,\Sigma))$ is defined as the unique $x\in \tau_\beta$, if there is one, such that $x \cap \tau_\gamma = \chi``\Sigma$.

It is a hypothesis of the construction that for $\beta<\alpha$, the function $\chi$ is defined at every $\beta$-code, and that the range of $\chi$ is all of $\tau_\beta$.

We define $\tau_\alpha$ as the collection of elements $x$ of $\tau^3_\alpha$ for which there is an $\alpha$-code $(S,\Sigma)$ and $\gamma<\alpha$ such that $x \cap \tau_\gamma = \chi``\Sigma$.

For any $\beta$-code $(S,\Sigma)$ and $\beta$-substitution $\sigma$, we define $\sigma[(S,\Sigma)]$ as $(\sigma[S],\{\sigma_\gamma[c]:c \in \Sigma\})$.  Standard properties of permutations and supports show that $\sigma[(S,\Sigma)]$ is a code for $\sigma[\chi((S,\Sigma))]$.

We define $\sigma^+(x)$ as $\sigma[x]$ for each $\beta$-substitution $\sigma$ and $x \in \tau_\beta$.  Note that $\sigma^+$ determines and is determined by $\sigma$.  The collection of permutations $\sigma^+$  is the collection of {\em $\beta$-allowable permutations\/} discussed in other treatments;
we may have some use for this below.


\item We describe the selection of designated codes for each element of our structure.

We choose a preliminary designated code for each element of the structure (this is necessary because objects other than atoms which have codes clearly have more than one):  we are actually
choosing designated codes for elements of $\tau_\alpha$ and continuing to use codes already chosen for the earlier constructed types.

We impose the technical condition that for each $\beta \leq \alpha$ and $x \in \tau_\beta$, if $x$ has the same $-1$ extension as an element $x'$  of $\tau_0$, and the designated support of $x'$ is $S$, the designated support of $x$ has as its members exactly the $(u,\{\beta,-1\})$ such that $(u,\{0,-1\}) \in S$ and the $(v_\beta,\{\beta\})$ such
that $(v_0,\{0\})\in S$.  It is straightforward to see that elements of $\tau_0$ are exactly the $X_0$ such that $X \subseteq \tau_{-1}$ has small symmetric difference from a small or co-small union of litters, that any element of $\tau_0$ has support elements of exactly the kinds described, and that an $x \in \tau_\beta$ with the same extension as
an element of $\tau_0$ does have the described set as a support.

A support $S$ is said to be {\em strong\/} iff

\begin{enumerate}

\item for every $(N_\delta,A) \in S$, $N$ is a litter, and
\item  for every atomic support element $(x,A)$ in $S$ there is $$(N,A\setminus\{-1\}) \in S$$ with $x \in N$, and 

\item for every support element of the form $(f_{\delta,\epsilon}(x)_\epsilon,A) \in S$ for which $\delta$ is dominated by every element of $A$ except $\epsilon$ we also have for each $(y,C)$ in the preliminary designated support
of $x$ that $$(y,(B \setminus \{\epsilon\})\cup C)\in S.$$

\end{enumerate}  It should be evident that any support can be modified to one satisfying the first condition by replacing each element
$(N_\delta,A)$ with $(N^\circ_\delta,A)$ and the $(x,A\cup \{-1\})$ such that $x \in N \Delta N^\circ$:  modifying the first component of a code
in this way will preserve acceptability of the code, because any substitution whose action preserves the modified code also preserves the original code.

A code thus modified can be extended to a strong support satisfying the other two conditions simply by enforcing these closure conditions through $\omega$ steps.  The designated support of each object is obtained by extending the first projection
of the preliminary designated support to the smallest strong support including  it as a subset.

We refer to support elements of the form $(f_{\delta,\epsilon}(x)_\epsilon,A)$ for which $\delta$ is dominated by every element of $A$ except $\epsilon$ as {\em inflexible\/} support elements [because the coherence conditions restrict how substitutions can act on them], and refer to all other near-litter support elements as {\em flexible\/} support elements.

\item Specific elements of $\tau_\alpha$'s whose existence was postulated above need to be shown to be codable.  $\emptyset_\gamma$ is coded by $(\emptyset,\emptyset)$.  If $x$ is an atom, $\{x\}_\gamma$ is coded by $(\{(x,\{\gamma,-1\})\},\{x\})$.  If $N$ is a near-litter,
$N_\gamma$ is coded by $(\{(\{N_\gamma,\{\gamma\}),N\}$.

\item  We describe the construction of the well-orderings $\leq_\iota$ in detail.

We define a conversion function $c$ on support elements:  $c((x,A)) = \{x\}_{{\tt min}(A\setminus \{-1\})}$ or $x_{{\tt min}(A)}$, whichever is defined.

We fiirst construct an order $\leq_0$  on $\tau_0$.  We choose an arbitrary order on elements of $\tau_0$ and proceed in alternating stages indexed by $\mu$:  at an even stage, we place the first so far unplaced litter, then place all atoms in it in an arbitrarily chosen order, then place all near-litters with small symmetric difference from a litter placed earlier and with all elements of the symmetric difference already placed.  At an odd stage, we place the first element of $\tau_0$ which is not a typed atom or near-litter and whose designated support contains no support item whose image under the conversion function has not already been placed, if there is one.  It should be evident that all elements of $\tau_0$ are eventually placed.

The order $\leq_{-1}$
is induced by the order on typed atoms in $\tau_0$ which is a suborder of $\leq_0$.



We describe how to construct all $\leq_\alpha$ for $\alpha\geq 0$.  We collect the extensional type $\alpha$ sets which are codable and designate a code for each one (axiom of choice) and convert the included support to a strong support as described above. We place the typed atoms and near-litters  in $\leq_\alpha$ in the same positions at which the typed atoms and near-litters with the same $-1$-extensions are placed in
$\leq_0$ (we described this above).  We provide ourselves with an arbitrary well-ordering of the other sets in type $\alpha$ of order type $\mu$.  At each step, we go to the first unfilled position and choose the first set in the arbitrary ordering from $\tau_\alpha$ whose designated strong support does not include any support element whose image under $c$ has been placed in a later position (in its own type) and place it there, ensuring that there will be one by making the additional requirement that no set with nonempty $-1$-extension can be placed earlier than the position of the set with the same $-1$-extension  in $\leq_0$:  this ensures that when we are filling an unfilled position, the object with the same $-1$-extension as the object at the same position in $\leq_0$ is available as a candidate [this is where the technical condition on designated supports for sets with $-1$-extensions shared with elements of $\tau_0$ is used].   Every code is eventually placed, so the entire well ordering is filled (any given item will eventually be placeable because of the cofinality of $\mu$ being at least $\kappa$ and the fact that supports are small).

\item All that is needed to ensure that this works is the assurance that there are no more than $\mu$ codes, which ensures that there are exactly $\mu$ elements of each type.

\item  There are exactly $\mu$ near-litters (this depends on the fact that $\mu$ is of cardinality at least $\kappa$) and there are exactly $\mu$ supports.

Note that it is evident that there are at least $\mu$ elements in any $\tau_\beta$ (consider typed atoms).

We will need to prove a theorem about the freedom of action of substitutions first.

\item Our criterion for acceptability of codes enforces a high degree of symmetry, assuming that substitutions act fairly freely on our structure.  We state a theorem about this.

A {\em $\beta$-partial substitution\/} is an injective map $\sigma$ from $\beta$-support items to $\beta$-support items with domain and range the same, satisfying $\pi_2(\sigma(x,A)) = A$, satisfying for each litter $L$ and each $A$ with minimum $-1$ that the set $\{(x,A): x \in L \wedge (x,A) \in {\tt dom}(\sigma)\}$ is small, and satisfying that each $(N_\delta,A)$
in the domain of $\sigma$ has $N$ a litter and is flexible.  Recall that this means that $N=N^\circ$ is not in the range of $f_{\gamma,\delta}$ for any $\gamma$ dominated by all elements of $A \setminus \{\delta\}$.

 We say that an atomic support element $(x,A)$ is an {\em exception\/} of a substitution $\sigma$ iff it satisfies the following condition:
let $L$ be the litter containing $x$; either $$\pi_1(\sigma(x,A)) \not\in \pi_1(\sigma[(L,A \setminus \{-1\})])^\circ$$ or $$\pi_1(\sigma^{-1}(x,A)) \not\in \pi_1(\sigma^{-1}[(L,A \setminus \{-1\})])^\circ.$$

The Freedom of Action theorem asserts that for each partial substitution $\sigma_0$  there is a substitution $\sigma$ which extends it in the qualified sense that $\sigma((x,A)) =\sigma_0((x,A))$ where the latter is defined and $x$ is an atom, and $\pi_1(\sigma[(N_\gamma,A)])^\circ = \pi_1(\sigma_0((N_\gamma,A))$ where $N$ is a near-litter and the latter is defined, and further $\sigma$ has no exceptions other than elements of its domain.

\item  Let $\sigma_0$ be a $\beta$-partial substitution.  We describe a method of computing a $\beta$-substitution $\sigma$ whose action extends $\sigma_0$.

We first extend $\sigma_0$ so that its domain includes all $(L,A)$ which are flexible with $L$ a litter.  This can be done by extending $\sigma_0$ to act as the identity on all such items originally not in its domain, but all that is really necessary is that the map be one-to-one and onto on such items.  We use $\sigma_0$ hereinafter to refer to this extended partial substitution.

For any co-small subsets of litters $L,M$ we define $\sigma_{L,M}$ as the unique bijection from $L$ to $M$ which is strictly increasing in the order determined by fourth projections of the elements.  The details of definition of $\sigma_{L,M}$ play no role in the proof: all that mattes is that it is a bijection from $L$ to $M$.

We define $D_A$ as $\{x:x \in \tau_{-1} \wedge (x,A) \in {\tt dom}(\sigma_0)\}$.

We extend the definition of $\iota_*$ to support elements.  For $(x,A)$ atomic we define $\iota_*((x,A))$ as $\iota_*(\{x\}_{{\tt min}(A\setminus \{-1\}})$.  For $(N,A)$ near-litter, we define $\iota_*((N,A))$ as $\iota_*(N_{{\tt min}(A)})$.

We show how to compute the action of $\sigma$ at each support item, assuming that we have computed its action for all support items with smaller image under $\iota_*$ as just extended.

For any $(x,A)$ atomic with $\gamma={\tt min}(A \setminus \{-1\})$, we know that where $L$ is the litter containing $x$, $\iota_*(L_\gamma)<\iota_*(\{x\}_\gamma)$, so $$\iota_*((x,A))<\iota_*((L_\gamma,A \setminus\{-1\})),$$ so $\sigma[(L_\gamma,A\setminus \{-1\})]$ has already been computed.  We compute $\sigma((x,A))$ as either $\sigma_0((x,A))$ or $(\sigma_{L\setminus D_A,\pi_1(\sigma((L,A\setminus \{-1\})))^\circ\setminus D_A}(x),A)$.

For any $(N_\gamma,A)$ where $N$ is a near-litter which is not a litter, we have $\iota_*(N^\circ_\gamma,A) = \iota_*(N^\circ_\gamma)<\iota_*(N_\gamma))$ and $\iota_*((x,A\cup \{-1\})) = \iota_*(\{x\}_\gamma)<\iota_*(N_\gamma)$ for each $x \in N \Delta N^\circ$, which obviously gives us enough information to compute the action of $\sigma$ on $(N_\gamma,A)$,
since we know the actions on $(N^\circ_\gamma,A)$ and each $(x,A\cup \{-1\})$ with $x \in N \Delta N^\circ$.

It remains to indicate how to compute the action of $\sigma$ on $(L_\gamma,A)$ where $L$ is a litter.

We indicate how to compute $\pi_1(\sigma((x,A \cup \{-1\}))$ for each $x \in L$ if we know how to compute $\sigma[(L_\gamma,A)]^\circ$.  If $x \in D_A \cap L$, we compute  $$\pi_1(\sigma((x,A \cup \{-1\}))= \pi_1(\sigma_0((x,A \cup \{-1\})).$$  We define $S_{A,L}$ as $\{x \in D_A: x \not\in L \wedge \pi_1(\sigma_0((x,A \cup \{-1\})) \in \pi_1(\sigma[(L_\gamma,A)]))\}$.
For each $x \in L \setminus D_A$, we compute $\pi_1(\sigma((x,A \cup \{-1\}))$ as $$(\sigma_{L \setminus D_A,\pi_1(\sigma[(L,A)]) \setminus S_{A,L}}(x),A \cup \{-1\}).$$

We have thus indicated how to compute $$\sigma[(L,A)] = (\{\{\pi_1(\sigma((x,A \cup \{-1\})):x \in L\}_\gamma,A).$$

This handles the case where $(L_\gamma,A)$ is flexible immediately, because we can compute $\sigma[(L_\gamma,A)]^\circ$ as $\pi_1(\sigma_0(L_\gamma,A))$.

The remaining case is to compute $\sigma[(L_\gamma,A)]$ in the case where $L = f_{\delta,\gamma}(x)$ for some $\delta$ dominated by all members of $A \setminus \gamma$.

If $(L_{\gamma},A)$ is not flexible, we have $L_\gamma = f_{\delta,\gamma}(u)$ for some $\delta<\beta$ and $u \in \tau_\delta$.  For every element $(v,B)$ of the designated strong support $S$ of $u$, we have $\iota_*(v,B)<\iota_*(L_\gamma,\alpha)$, so we have already computed
the action of $\sigma$ at each $(v,B\cup (A \setminus \{\gamma\}))\in S$ (which has the same image under $\iota_*$).  

Suppose $\delta=0$.  $u$ is then an atom and we already know how to compute the action of $\sigma$ at $(u,(A \setminus \gamma) \cup \{-1\})$, from which we can compute  $\sigma[(L_\gamma,A)]^\circ$ as $(f_{-1,\gamma}(\pi_1((u,(A \setminus \gamma) \cup \{-1\}))),A)$ and complete the calculation of  $\sigma[(L_\gamma,A)]$ as above.

Suppose $\delta>0$.  We define a $\delta$-partial substitution sending each $(v,B)\in S$ to $(\pi_1(\sigma[(v,B\cup (A \setminus \{\gamma\})]),B)$ if $v$ is atomic or to $(\pi_1(\sigma[(v,B\cup (A \setminus \{\gamma\})])^\circ,B)$ if $(v,B)$ is $\delta$-flexible.






\end{enumerate}


\end{document}

